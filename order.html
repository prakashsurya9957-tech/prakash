<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout - Star Pro Ice Cream</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .upi-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .upi-btn {
            padding: 1rem;
            border-radius: 1rem;
            border: 2px solid var(--border);
            background: white;
            cursor: pointer;
            text-align: center;
            font-weight: 600;
            transition: 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .upi-btn:hover {
            border-color: var(--primary);
            background: rgba(244, 143, 177, 0.05);
        }

        .upi-btn img {
            height: 20px;
        }

        .location-box {
            background: var(--accent);
            padding: 1rem;
            border-radius: 1rem;
            margin-top: 1.5rem;
            border: 1px dashed var(--primary);
        }
    </style>
</head>

<body>

    <button class="mobile-nav-toggle"><i class="fas fa-bars"></i></button>

    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fas fa-ice-cream"></i> STAR PRO
                </div>
            </div>

            <ul class="nav-links">
                <li><a href="profile.html"><i class="fas fa-user-circle"></i> Profile</a></li>
                <li><a href="menu.html"><i class="fas fa-ice-cream"></i> Ice Cream Menu</a></li>
                <li><a href="order.html" class="active"><i class="fas fa-shopping-basket"></i> Order</a></li>
                <li><a href="orders.html"><i class="fas fa-history"></i> Order History</a></li>
                <li><a href="customers.html"><i class="fas fa-users"></i> Customer Details</a></li>
                <li><a href="company.html"><i class="fas fa-building"></i> Company Details</a></li>
                <li><a href="location.html"><i class="fas fa-map-marker-alt"></i> Location</a></li>
                <li><a href="payments.html"><i class="fas fa-credit-card"></i> Payment / Transactions</a></li>
                <li><a href="contact.html"><i class="fas fa-phone-alt"></i> Contact Us</a></li>
            </ul>

            <button onclick="handleLogout()" class="btn btn-logout">
                <i class="fas fa-sign-out-alt"></i> Logout
            </button>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="page-header">
                <h1>Complete Your Order</h1>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 350px; gap: 2rem;">
                <div class="card">
                    <h2><i class="fas fa-shopping-cart" style="color: var(--primary)"></i> Your Cart</h2>
                    <div id="cart-container" style="margin-top: 1rem;">
                        <!-- Cart items will be loaded here -->
                    </div>
                </div>

                <div>
                    <div class="card">
                        <h2>Order Summary</h2>
                        <div style="margin: 1.5rem 0;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span>Subtotal</span>
                                <span id="subtotal">â‚¹0</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span>Delivery</span>
                                <span style="color: #2e7d32;">FREE</span>
                            </div>
                            <hr style="border: none; border-top: 1px solid var(--border); margin: 1rem 0;">
                            <div
                                style="display: flex; justify-content: space-between; font-weight: 700; font-size: 1.25rem;">
                                <span>Total</span>
                                <span id="total-amount" class="text-accent">â‚¹0</span>
                            </div>
                        </div>

                        <div class="location-box">
                            <p style="font-size: 0.85rem; margin-bottom: 0.5rem;"><i class="fas fa-map-marker-alt"></i>
                                Delivery Location</p>
                            <button onclick="fetchLocation()" class="btn btn-secondary"
                                style="font-size: 0.8rem; padding: 0.5rem;">
                                <i class="fas fa-crosshairs"></i> Fetch Live Location
                            </button>
                            <div id="location-status"
                                style="font-size: 0.75rem; margin-top: 0.5rem; color: var(--text-muted);">Not set</div>
                        </div>

                        <div class="upi-buttons">
                            <button class="upi-btn" onclick="processPayment('GPay')">
                                <i class="fab fa-google-pay"></i> GPay
                            </button>
                            <button class="upi-btn" onclick="processPayment('PhonePe')">
                                <i class="fas fa-mobile-alt"></i> PhonePe
                            </button>
                            <button class="upi-btn" onclick="processPayment('Paytm')">
                                <i class="fas fa-wallet"></i> Paytm
                            </button>
                            <button class="upi-btn" onclick="processPayment('UPI')">
                                <i class="fas fa-qrcode"></i> Any UPI
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="script.js"></script>
    <script>
        let currentLocation = null;

        function loadCart() {
            const cartItems = JSON.parse(localStorage.getItem('starpro_cart')) || [];
            const container = document.getElementById('cart-container');
            const subtotalEl = document.getElementById('subtotal');
            const totalEl = document.getElementById('total-amount');

            if (cartItems.length === 0) {
                container.innerHTML = `<div style="text-align: center; padding: 2rem; color: var(--text-muted);">
                    <i class="fas fa-shopping-basket fa-3x" style="margin-bottom: 1rem; opacity: 0.3;"></i>
                    <p>Your cart is empty.</p>
                    <a href="menu.html" style="color: var(--primary); text-decoration: none; font-weight: 600;">Go to Menu</a>
                </div>`;
                return;
            }

            let total = 0;
            container.innerHTML = cartItems.map((item, index) => {
                total += item.price;
                return `
                    <div class="cart-item">
                        <div>
                            <div style="font-weight: 600;">${item.name}</div>
                            <div style="font-size: 0.8rem; color: var(--text-muted);">Quantity: 1</div>
                        </div>
                        <div style="display: flex; gap: 1rem; align-items: center;">
                            <span style="font-weight: 600;">â‚¹${item.price}</span>
                            <i class="fas fa-trash-alt" style="color: #ef4444; cursor: pointer;" onclick="removeFromCart(${index})"></i>
                        </div>
                    </div>
                `;
            }).join('');

            subtotalEl.innerText = `â‚¹${total}`;
            totalEl.innerText = `â‚¹${total}`;
        }

        function removeFromCart(index) {
            let cart = JSON.parse(localStorage.getItem('starpro_cart')) || [];
            cart.splice(index, 1);
            localStorage.setItem('starpro_cart', JSON.stringify(cart));
            loadCart();
        }

        function fetchLocation() {
            const btn = event.target;
            const status = document.getElementById('location-status');
            status.innerText = "Accessing GPS...";

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        currentLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        };
                        status.innerText = `ðŸ“ Coords: ${currentLocation.lat.toFixed(4)}, ${currentLocation.lng.toFixed(4)}`;
                        status.style.color = "#2e7d32";
                    },
                    (error) => {
                        status.innerText = "Error: Permission Denied";
                        status.style.color = "#d32f2f";
                    }
                );
            } else {
                status.innerText = "Geolocation not supported";
            }
        }

        function processPayment(method) {
            const cart = JSON.parse(localStorage.getItem('starpro_cart')) || [];
            if (cart.length === 0) {
                alert("Please add items to cart first!");
                return;
            }

            if (!currentLocation) {
                alert("Please share your location for delivery!");
                return;
            }

            const total = cart.reduce((sum, i) => sum + i.price, 0);
            const overlay = document.createElement('div');
            overlay.style = "position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; display: flex; align-items: center; justify-content: center; color: white; flex-direction: column; text-align: center; backdrop-filter: blur(5px);";
            overlay.innerHTML = `
                <div style="background: white; padding: 2rem; border-radius: 2rem; color: var(--text-main); max-width: 300px;">
                    <i class="fas fa-spinner fa-spin fa-3x" style="color: var(--primary); margin-bottom: 1rem;"></i>
                    <h3>Connecting to ${method}</h3>
                    <p style="font-size: 0.9rem; color: var(--text-muted); margin-top: 0.5rem;">Authenticating transaction...</p>
                </div>
            `;
            document.body.appendChild(overlay);

            setTimeout(() => {
                overlay.innerHTML = `
                    <div style="background: white; padding: 2rem; border-radius: 2rem; color: var(--text-main); max-width: 310px;">
                        <i class="fas fa-check-circle fa-4x" style="color: #4caf50; margin-bottom: 1rem;"></i>
                        <h2 style="color: #2e7d32">Payment Successful!</h2>
                        <p style="margin: 1rem 0;">Transaction ID: <br><strong style="font-size: 0.8rem;">TXN${Date.now()}</strong></p>
                        <button class="btn btn-primary" onclick="confirmOrder('${method}')">Close & Confirm</button>
                    </div>
                `;
            }, 2000);
        }

        function confirmOrder(method) {
            const cart = JSON.parse(localStorage.getItem('starpro_cart')) || [];
            const total = cart.reduce((sum, i) => sum + i.price, 0);
            const user = JSON.parse(localStorage.getItem('starpro_user'));

            const newOrder = {
                id: Date.now(),
                items: cart.map(i => i.name),
                total: total,
                method: method,
                customer: user.name,
                customerPhone: user.phone,
                location: currentLocation,
                status: 'Placed',
                date: new Date().toISOString()
            };

            const orders = JSON.parse(localStorage.getItem('starpro_orders')) || [];
            orders.unshift(newOrder);
            localStorage.setItem('starpro_orders', JSON.stringify(orders));
            localStorage.removeItem('starpro_cart');

            window.location.href = 'orders.html';
        }

        document.addEventListener('DOMContentLoaded', loadCart);
    </script>
</body>

</html>